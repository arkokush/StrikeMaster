<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sign Up - Strike Master</title>
  <link rel="icon" type="image/png" href="../../assets/images/StrikeMasterLogo2.png">
  <link rel="stylesheet" type="text/css" href="../../assets/css/style.css">
  <link rel="stylesheet" type="text/css" href="../../assets/css/stored-colors.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="../../assets/js/accent-loader.js"></script>
  <script src="../../assets/js/config/api.js"></script>
  <script src="../../assets/js/config/teams.js"></script>
  <style>
    :root {
      --neutral-900: #111827;
      --neutral-700: #374151;
      --neutral-500: #6b7280;
      --neutral-300: #d1d5db;
      --neutral-100: #f3f4f6;
      --neutral-50: #f9fafb;
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--neutral-50);
      color: var(--neutral-900);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }
    .container {
      background: white;
      padding: 40px;
      border-radius: 16px;
      width: 440px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
      border: 1px solid var(--neutral-100);
    }
    .logo {
      text-align: center;
      margin-bottom: 16px;
    }
    .logo img {
      width: 72px;
      height: 72px;
      object-fit: contain;
    }
    .brand-name {
      text-align: center;
      font-size: 26px;
      font-weight: 700;
      color: var(--neutral-900);
      margin: 0 0 4px;
      letter-spacing: -0.5px;
    }
    .brand-name span {
      color: var(--neutral-500);
      font-weight: 500;
    }
    .subtitle {
      text-align: center;
      color: var(--neutral-500);
      margin-bottom: 25px;
      font-size: 14px;
    }

    /* Role Selection */
    .role-selection {
      display: flex;
      gap: 12px;
      margin-bottom: 25px;
    }
    .role-card {
      flex: 1;
      padding: 20px 16px;
      border: 1px solid var(--neutral-300);
      border-radius: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      background: white;
    }
    .role-card:hover {
      border-color: var(--neutral-900);
      background: var(--neutral-50);
    }
    .role-card.selected {
      border-color: var(--neutral-900);
      border-width: 2px;
      background: var(--neutral-50);
    }
    .role-card .icon {
      width: 40px;
      height: 40px;
      margin: 0 auto 10px;
      background: var(--neutral-100);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .role-card .icon svg {
      width: 22px;
      height: 22px;
      stroke: var(--neutral-700);
    }
    .role-card h3 {
      margin: 0 0 4px;
      font-size: 16px;
      font-weight: 600;
      color: var(--neutral-900);
    }
    .role-card p {
      margin: 0;
      font-size: 12px;
      color: var(--neutral-500);
    }

    /* Forms */
    .form-section {
      display: none;
    }
    .form-section.active {
      display: block;
    }
    label {
      display: block;
      margin-top: 14px;
      font-weight: 500;
      color: var(--neutral-700);
      font-size: 14px;
    }
    input, select {
      width: 100%;
      padding: 11px 14px;
      margin-top: 6px;
      border: 1px solid var(--neutral-300);
      border-radius: 8px;
      box-sizing: border-box;
      font-size: 15px;
      font-family: inherit;
      transition: border-color 0.2s, box-shadow 0.2s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: var(--neutral-900);
      box-shadow: 0 0 0 3px rgba(17, 24, 39, 0.08);
    }
    .name-row {
      display: flex;
      gap: 12px;
    }
    .name-row > div {
      flex: 1;
    }
    button {
      width: 100%;
      padding: 13px;
      margin-top: 22px;
      background: var(--neutral-900);
      color: white;
      font-weight: 600;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-family: inherit;
      transition: all 0.2s;
    }
    button:hover {
      background: var(--neutral-700);
      transform: translateY(-1px);
    }
    button:disabled {
      background: var(--neutral-300);
      cursor: not-allowed;
      transform: none;
    }
    .message {
      margin-top: 16px;
      text-align: center;
      font-weight: 500;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
    }
    .message.error {
      background: #fef2f2;
      color: #dc2626;
    }
    .message.success {
      background: #f0fdf4;
      color: #16a34a;
    }
    .message.loading {
      background: var(--neutral-100);
      color: var(--neutral-500);
    }
    .back {
      display: block;
      text-align: center;
      margin-top: 20px;
      color: var(--neutral-500);
      text-decoration: none;
      font-size: 14px;
      transition: color 0.2s;
    }
    .back:hover {
      color: var(--neutral-900);
    }
    .login-link {
      text-align: center;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--neutral-100);
      font-size: 14px;
      color: var(--neutral-500);
    }
    .login-link a {
      color: var(--neutral-900);
      font-weight: 600;
      text-decoration: none;
    }
    .login-link a:hover {
      text-decoration: underline;
    }
    .team-code-display {
      background: var(--neutral-50);
      border: 2px dashed var(--neutral-300);
      border-radius: 10px;
      padding: 15px;
      text-align: center;
      margin-top: 15px;
    }
    .team-code-display .code {
      font-size: 28px;
      font-weight: 700;
      color: var(--neutral-900);
      letter-spacing: 3px;
    }
    .team-code-display .hint {
      font-size: 12px;
      color: var(--neutral-500);
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="logo">
      <img src="../../assets/images/Team Logos/phLogo.png" alt="Strike Master">
    </div>
    <h2 class="brand-name">Strike<span>Master</span></h2>
    <p class="subtitle">Choose your role to get started</p>

    <!-- Role Selection -->
    <div class="role-selection" id="roleSelection">
      <div class="role-card" data-role="coach" onclick="selectRole('coach')">
        <div class="icon">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
        </div>
        <h3>Coach</h3>
        <p>Manage team & enter scores</p>
      </div>
      <div class="role-card" data-role="student" onclick="selectRole('student')">
        <div class="icon">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
        </div>
        <h3>Student</h3>
        <p>View team stats (read-only)</p>
      </div>
    </div>

    <!-- Coach Sign Up Form -->
    <div class="form-section" id="coachForm">
      <form id="coachSignupForm">
        <div class="name-row">
          <div>
            <label>First Name</label>
            <input type="text" id="coachFirstName" placeholder="John" required>
          </div>
          <div>
            <label>Last Name</label>
            <input type="text" id="coachLastName" placeholder="Smith" required>
          </div>
        </div>
        <label>School</label>
        <select id="coachSchool" required>
          <option value="">Select your school</option>
        </select>
        <label>Email</label>
        <input type="email" id="coachEmail" placeholder="coach@school.edu" required>
        <label>Password</label>
        <input type="password" id="coachPassword" placeholder="Min 6 characters" required minlength="6">
        <button type="submit" id="coachSubmitBtn">Create Coach Account</button>
      </form>
    </div>

    <!-- Student Sign Up Form -->
    <div class="form-section" id="studentForm">
      <form id="studentSignupForm">
        <label>Email</label>
        <input type="email" id="studentEmail" placeholder="you@example.com" required>
        <label>Password</label>
        <input type="password" id="studentPassword" placeholder="Create a password" required minlength="6">
        <label>Team Code</label>
        <input type="text" id="studentCode" placeholder="Code from your coach" required maxlength="6" style="text-transform: uppercase;">
        <button type="submit" id="studentSubmitBtn">Create Student Account</button>
      </form>
    </div>

    <div class="message" id="message" style="display: none;"></div>

    <div class="login-link">
      Already have an account? <a href="login.html">Log In</a>
    </div>

    <a class="back" href="../../index.html">‚Üê Back to Home</a>
  </div>

  <script>
    let selectedRole = null;
    const msgEl = document.getElementById('message');

    // Populate school dropdown
    const schoolSelect = document.getElementById('coachSchool');
    SCHOOLS_LIST.forEach(school => {
      const option = document.createElement('option');
      option.value = school.value;
      option.textContent = school.name;
      schoolSelect.appendChild(option);
    });

    function selectRole(role) {
      selectedRole = role;
      
      // Update UI
      document.querySelectorAll('.role-card').forEach(card => {
        card.classList.toggle('selected', card.dataset.role === role);
      });
      
      // Show appropriate form
      document.getElementById('coachForm').classList.toggle('active', role === 'coach');
      document.getElementById('studentForm').classList.toggle('active', role === 'student');
      
      // Hide message
      msgEl.style.display = 'none';
    }

    function showMessage(text, type) {
      msgEl.innerHTML = text;
      msgEl.className = `message ${type}`;
      msgEl.style.display = 'block';
    }

    // Coach Sign Up
    document.getElementById('coachSignupForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const firstName = document.getElementById('coachFirstName').value.trim();
      const lastName = document.getElementById('coachLastName').value.trim();
      const school = document.getElementById('coachSchool').value;
      const email = document.getElementById('coachEmail').value.trim();
      const password = document.getElementById('coachPassword').value;
      
      if (!school) {
        showMessage('Please select a school', 'error');
        return;
      }
      
      const btn = document.getElementById('coachSubmitBtn');
      btn.disabled = true;
      btn.textContent = 'Creating account...';
      showMessage('Setting up your account...', 'loading');

      try {
        const res = await api.post('/api/auth/signup', {
          firstName,
          lastName,
          teamName: school,
          email,
          password
        });
        const data = await res.json();
        
        if (!res.ok) {
          showMessage(data.error || 'Sign up failed', 'error');
          btn.disabled = false;
          btn.textContent = 'Create Coach Account';
          return;
        }

        // Store auth
        if (data.token) localStorage.setItem('bowling_token', data.token);
        if (data.user) {
          localStorage.setItem('bowling_user', JSON.stringify(data.user));
          localStorage.setItem('bowling_role', 'coach');
        }

        const teamCode = data.user?.team_code || '------';
        showMessage(`
          Account created!<br><br>
          <div class="team-code-display">
            <div class="code">${teamCode}</div>
            <div class="hint">Share this code with your students</div>
          </div>
          <br>Redirecting to dashboard...
        `, 'success');

        setTimeout(() => {
          window.location.href = '../dashboard/teamSelector.html';
        }, 3500);
        
      } catch (err) {
        console.error(err);
        showMessage('Network error. Please try again.', 'error');
        btn.disabled = false;
        btn.textContent = 'Create Coach Account';
      }
    });

    // Student Sign Up
    document.getElementById('studentSignupForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = document.getElementById('studentEmail').value.trim();
      const password = document.getElementById('studentPassword').value;
      const teamCode = document.getElementById('studentCode').value.trim().toUpperCase();
      
      const btn = document.getElementById('studentSubmitBtn');
      btn.disabled = true;
      btn.textContent = 'Creating account...';
      showMessage('Verifying team code...', 'loading');

      try {
        const res = await api.post('/api/auth/student-signup', {
          email,
          password,
          teamCode
        });
        const data = await res.json();
        
        if (!res.ok) {
          showMessage(data.error || 'Sign up failed', 'error');
          btn.disabled = false;
          btn.textContent = 'Create Student Account';
          return;
        }

        // Store auth
        if (data.user) {
          localStorage.setItem('bowling_user', JSON.stringify(data.user));
          localStorage.setItem('bowling_role', 'student');
        }

        showMessage(`Account created! Welcome to ${data.teamName || 'the team'}!<br>Redirecting...`, 'success');

        setTimeout(() => {
          window.location.href = '../dashboard/teamSelector.html';
        }, 1500);
        
      } catch (err) {
        console.error(err);
        showMessage('Network error. Please try again.', 'error');
        btn.disabled = false;
        btn.textContent = 'Create Student Account';
      }
    });
  </script>
</body>
</html>
